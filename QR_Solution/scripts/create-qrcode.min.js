function initAutocomplete(){var u=this,n=new google.maps.Map(document.getElementById("map"),{center:{lat:21.0277644,lng:105.83415979999995},zoom:13,mapTypeId:"roadmap"}),t=new google.maps.Marker({map:n}),r,i;n.addListener("click",function(i){t.setMap(null);t=new google.maps.Marker({map:n,position:i.latLng});create.getLocation(t)});r=document.getElementById("pac-input");i=new google.maps.places.SearchBox(r);n.controls[google.maps.ControlPosition.TOP_LEFT].push(r);n.addListener("bounds_changed",function(){i.setBounds(n.getBounds())});i.addListener("places_changed",function(){var u=i.getPlaces(),r;u.length!=0&&(t.setMap(null),r=new google.maps.LatLngBounds,u.forEach(function(i){i.geometry&&(t=new google.maps.Marker({map:n,title:i.name,position:i.geometry.location}),create.getLocation(t),i.geometry.viewport?r.union(i.geometry.viewport):r.extend(i.geometry.location))}),n.fitBounds(r))});$("#pac-input").val("Hà Nội, Việt Nam")}function createQRCode(){this.validate=function(){$("#urlInput").on("change",function(){var n=validation.StringRequired("#urlInput","URL",!1);n||validation.URLValidate("#urlInput","URL",!1)});$("#textInput").on("change",function(){var n=validation.StringRequired("#textInput","Text",!1);n||validation.LengthVlidate("#textInput","Text",100,4,!1)});$("#phoneInput").on("change",function(){var n=validation.StringRequired("#phoneInput","Số Điện Thoại",!1);n||validation.LengthVlidate("#phoneInput","Số Điện Thoại",11,10,!1)});$("#smsphone").on("change",function(){var n=validation.StringRequired("#smsphone","Số Điện Thoại",!1);n||validation.LengthVlidate("#smsphone","Số Điện Thoại",11,10,!1)});$("#smscontent").on("change",function(){validation.StringRequired("#smscontent","Nội dung tin nhắn",!1)});$("#emailInput").on("change",function(){var n=validation.StringRequired("#emailInput","Email",!1);n||validation.EmailValidate("#emailInput","Email",!0)});$('input[name="mode"]').on("change",function(){$(this).val()=="dynamic"&&(toastr.remove(),toastr.warning("Đăng ký dùng thử để sử dụng QR code Dynamic."),setTimeout(function(){$("#test5").prop("checked",!0)},350))})};this.getLocation=function(n){mapLat=n.getPosition().lat().toString();mapLng=n.getPosition().lng().toString();console.log("lat"+mapLat," and long"+mapLng)};this.getQRType=function(){$('a[data-toggle="tab"]').on("shown.bs.tab",function(n){$(".nav-tabs li").removeClass("active");$(n.target).parent().addClass("active");$('input[type="text"],textarea').val("");var i=$(n.target).attr("href"),t=$(".tab-content").find(".active").attr("data-type");console.log(t);common.previewScreenMobile(t);$("body").removeClass("hidden-create");switch(i){case"#register":$("body").addClass("hidden-create");break;case"#mapPannel":$('script[src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDI7umPm-nfmN_nI9Okt7dueSb1sZoLimQ&libraries=places&callback=initAutocomplete"]').length<=0&&$("body").append('<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDI7umPm-nfmN_nI9Okt7dueSb1sZoLimQ&libraries=places&callback=initAutocomplete" async defer><\/script>')}})};this.saveQrCode=function(){$("#createQR").on("click",function(){var i=$(".tab-content").find(".active").attr("data-type"),u=$(".tab-content").find(".active").find("input").val(),r,n,t;switch(i){case"url":if(n=!1,t=validation.StringRequired("#urlInput","URL",!1),t||(n=validation.URLValidate("#urlInput","URL",!1)),t||n)return;r={name:"qrcode",type:i,mode:"static",template:null,taget_scan:"0",data:{url:u.trim()}};break;case"text":if(n=!1,t=validation.StringRequired("#textInput","Text",!1),t||(n=validation.LengthVlidate("#textInput","Text",100,4,!1)),n||n)return;r={name:"qrcode",type:i,mode:"static",template:null,taget_scan:"0",data:{content:u}};break;case"phone":if(n=!1,t=validation.StringRequired("#phoneInput","Số Điện Thoại",!1),t||(n=validation.LengthVlidate("#phoneInput","Số Điện Thoại",11,10,!1)),t||n)return;r={name:"qrcode",type:i,mode:"static",template:null,taget_scan:"0",data:{number:u}};break;case"sms":var n=!1,e=!1,f=!1;if(f=validation.StringRequired("#smsphone","Số Điện Thoại",!1),f||(n=validation.LengthVlidate("#smsphone","Số Điện Thoại",11,10,!1),n||(e=validation.StringRequired("#smscontent","Nội dung tin nhắn",!1))),e||f||n)return;r={name:"qrcode",type:i,mode:"static",template:null,taget_scan:"0",data:{smsto:$("#smsphone").val(),content:$("#smscontent").val()}};break;case"email":if(n=!1,t=validation.StringRequired("#emailInput","Email",!1),t||(n=validation.EmailValidate("#emailInput","Email",!0)),t||n)return;r={name:"qrcode",type:i,mode:"static",template:null,taget_scan:"0",data:{content:$("#emailInput").val()}};break;case"geo":r={name:"qrcode",type:i,mode:"static",template:null,taget_scan:"0",data:{latitude:mapLng,longitude:mapLat}}}$.ajax({url:"http://mirascan.vn:32000/api/qrcode-api/create",type:"POST",data:JSON.stringify(r),dataType:"json",success:function(n){if(n.status=="success"){var t=n.data.id;window.location="customize.html?id="+t}else{console.log("save error");return}},error:function(n,t,i){console.log(i);console.log("something error")}})})};this.init=function(){this.validate();this.getQRType();this.saveQrCode();common.HoverPreviewMode();common.previewScreenMobile("url")}}var common=new CommonFunction,validation=new FEValidation,create=new createQRCode,mapLat,mapLng;$(document).ready(function(){create.init()});